<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Todo List</title>
  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="main.css">
  <script src="https://cdn.staticfile.org/react/16.4.0/umd/react.development.js"></script>
  <script src="https://cdn.staticfile.org/react-dom/16.4.0/umd/react-dom.development.js"></script>
  <script src="https://cdn.staticfile.org/babel-standalone/6.26.0/babel.min.js"></script>
  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    class TodoApp extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          items: [],
        };
        this.addItem = this.addItem.bind(this);
        this.deleteItem = this.deleteItem.bind(this);
      }
      
      addItem(item) {
        const newItem = {
          text: item.text,
          id: Date.now(),
        }
        this.setState({
          items: this.state.items.concat(newItem)
        });
      }

      deleteItem(index) {
        this.state.items.splice(index, 1);
        this.setState({
          items: this.state.items
        })
      }
  
      render() {
        return (
          <div className="container">
            <h1>TODO</h1>
            <TodoList items={this.state.items} deleteClick={this.deleteItem} />
            <TodoForm addItem={this.addItem} items={this.state.items} />
          </div>
        );
      }
    }
    
    class TodoForm extends React.Component {
      constructor(props) {
        super(props);
        this.state = { text: '' }
        this.handleChange = this.handleChange.bind(this);
        this.handleSubmit = this.handleSubmit.bind(this);
      }

      handleChange(e) {
        this.setState({ text: e.target.value })
      }

      handleSubmit(e) {
        e.preventDefault();
        if(!this.state.text) {
          return;
        }
        this.props.addItem({text: this.state.text})
        this.setState({text: ''})
      }
      render() {
        return (
          <form onSubmit={this.handleSubmit}>
            <input onChange={this.handleChange}  className="form-control form-control-lg" type="text" value={this.state.text} placeholder="如：今天我要吃大盘鸡" />
            <div className="mt-3 text-center">
              <button type="submit" className="btn btn-primary">Add #{this.props.items.length + 1}</button>  
            </div>
          </form>
        );
      }
    }

    class TodoList extends React.Component {
      render() {
        const list = this.props.items.map((item, index) => {
          return (
            <TodoListItem 
              key={item.id}
              text={item.text}
              index={index}
              removeItem={this.props.deleteClick}
            />
          );
        })

        return (
          <ul className="mb-3">{list}</ul>
        );
      }
    }

    class TodoListItem extends React.Component {
      constructor(props) {
        super(props);
        this.handleClick = this.handleClick.bind(this);
      }
      handleClick() {
        const index = parseInt(this.props.index);
        this.props.removeItem(index);
      }
      render() {
        return (
          <li className="alert alert-info row" role="alert">
            <div className="col-md-10">{this.props.text}</div>
            <div className="col-md-2 text-right">
              <input type="button" onClick={this.handleClick} className="btn btn-sm btn-danger" value="删除" />
            </div>
          </li>
        );
      }
    }

    ReactDOM.render(
      <TodoApp />,
      document.getElementById('root')
    )
  </script>
</body>

</html>